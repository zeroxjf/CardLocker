<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CardLocker for macOS</title>
  <style>
    /* =========== Reset & Base Styles =========== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    html, body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
                   Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      background-color: #f9f9fb;
      color: #1c1c1e;
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
    }
    a {
      color: #007aff;
      text-decoration: none;
      transition: color 0.2s ease;
    }
    a:hover {
      color: #005bb5;
      text-decoration: underline;
    }

    /* ===== Container ===== */
    .container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    /* ===== Navbar ===== */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 0;
      background-color: #ffffff;
      border-bottom: 1px solid #e0e0e5;
    }
    .nav-brand {
      font-size: 1.5rem;
      font-weight: 700;
      color: #007aff;
    }
    .nav-links {
      list-style: none;
      display: flex;
      gap: 2rem;
    }
    .nav-links li a {
      font-weight: 500;
      padding: 0.5rem 0;
      color: #1c1c1e;
      transition: color 0.2s ease;
    }
    .nav-links li a:hover {
      color: #007aff;
    }

    /* ===== Hero Section ===== */
    .hero {
      text-align: center;
      padding: 3rem 1rem;
      background-color: #ffffff;
      margin-bottom: 2rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .hero h1.title-with-icon {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 2.5rem;
      font-weight: 700;
      color: #0056b3;
    }
    .hero p.intro {
      margin-top: 1rem;
      font-size: 1.125rem;
      line-height: 1.5;
      color: #3c3c43;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    /* ===== Main Layout ===== */
    main {
      display: flex;
      justify-content: space-between;
      gap: 3rem;
      flex-wrap: wrap;
      margin-bottom: 3rem;
    }
    .card-container {
      flex: 1 1 500px;
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }
    .side-panel {
      flex: 0 0 500px;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 2rem;
    }

    /* ===== Card Styling & Hover Effects ===== */
    .card {
      background-color: #ffffff;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
    }
    .card h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: #0056b3;
    }
    .card p,
    .card ul,
    .card ul li {
      font-size: 1rem;
      line-height: 1.6;
      color: #2c2c2e;
    }
    .card ul {
      padding-left: 1.25rem;
    }
    .card ul li {
      margin-bottom: 0.75rem;
    }

    /* ===== Screenshot & Icon Adjustments ===== */
    .app-icon-inline {
      width: 40px;
      height: 40px;
    }
    .screenshot {
      width: 100%;
      max-width: none;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      margin-bottom: 1rem;
      object-fit: cover;
    }

    /* ===== Footer ===== */
    .site-footer {
      background-color: #f2f2f7;
      border-top: 1px solid #d1d1d6;
      padding: 1.5rem 0;
      margin-top: 3rem;
    }
    .footer-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .footer-links a {
      color: #3c3c43;
      text-decoration: none;
      margin: 0 0.5rem;
      font-weight: 500;
    }
    .footer-links a:hover {
      color: #007aff;
    }

    /* Section Spacing */
    #features, 
    #how-it-works, 
    #purchase, 
    #resend {
      margin-bottom: 2rem;
    }

    /* Privacy disclaimer */
    .privacy-disclaimer {
      font-size: 0.875rem;
      color: #6e6e73;
      font-style: italic;
      text-align: center;
      margin: 2rem 1rem 0;
    }

    /* ===== Plan Options Styling ===== */
    /* ===== Modal Backdrop ===== */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .modal-backdrop.show {
      display: flex;
      opacity: 1;
    }
    .plan-options {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-top: 1rem;
    }
    .plan {
      flex: 1 1 150px;
      background-color: #f9f9f9;
      border: 1px solid #d1d1d6;
      border-radius: 10px;
      padding: 1rem 1rem 6rem;
      text-align: center;
      position: relative;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .plan:hover {
      border-color: #007aff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .plan h3 {
      font-size: 1.25rem;
      margin-bottom: 0.75rem;
      color: #1c1c1e;
    }
    .plan p {
      font-size: 1rem;
      margin-bottom: 1rem;
      color: #3c3c43;
    }
    .plan .badge {
      position: absolute;
      top: -0.5rem;
      right: -0.5rem;
      background-color: #007aff;
      color: #ffffff;
      font-size: 0.75rem;
      font-weight: 600;
      padding: 0.25rem 0.5rem;
      border-radius: 8px;
    }
    .plan-select {
      background-color: #007aff;
      color: #ffffff;
      border: none;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .plan-select:hover {
      background-color: #005bb5;
    }
    .email-field {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      width: 100%;
      margin-top: 1rem;
    }
    .email-field input {
      width: 100%;
      box-sizing: border-box;
      padding: 0.75rem;
      border: 1px solid #d1d1d6;
      border-radius: 6px;
      font-size: 1rem;
    }
    .email-field a {
      display: block;
      width: 100%;
      text-align: center;
      background-color: #34c759;
      color: #ffffff;
      border: none;
      border-radius: 8px;
      padding: 0.75rem;
      font-size: 1rem;
      text-decoration: none;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .email-field a:disabled,
    .email-field a[disabled] {
      background-color: #a1a1aa;
      cursor: default;
      pointer-events: none;
    }
    .email-field a:not([disabled]):hover {
      background-color: #28a745;
    }
    /* Animation for checkmark and confirm button */
    .checkmark {
      font-size: 1.2rem;
      color: green;
      transition: opacity 0.3s ease-in-out;
    }
    .confirm-btn {
      transition: all 0.3s ease;
    }
    .confirm-btn.confirmed {
      display: none;
    }
    /* Modal window styling */
    .modal {
      background-color: #ffffff;
      border-radius: 12px;
      padding: 2rem;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    .modal h3 {
      margin-bottom: 1rem;
      color: #1c1c1e;
    }
    .modal p, .modal a, .modal strong {
      color: #1c1c1e;
    }
    .modal a#download-link {
      display: inline-block;
      margin-top: 0.5rem;
      color: #007aff;
      text-decoration: none;
    }
    .modal a#download-link:hover {
      text-decoration: underline;
    }
    .close-btn {
      margin-top: 1.5rem;
      background-color: #007aff;
      color: #ffffff;
      border: none;
      border-radius: 6px;
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .close-btn:hover {
      background-color: #005bb5;
    }
  </style>
<!-- PayPal SDK for one-time payments (guest checkout) -->
<script
  src="https://www.paypal.com/sdk/js?client-id=ARmFJUNL-2grFv62pdVgTgbaulkPP-lj2_3yEpzjdtz6RWt-h7ISTHqKTolA715eeR-74mIyu-MNE6Mp&vault=false&disable-funding=credit,card"
  data-namespace="paypalBuy"
></script>
<!-- PayPal SDK for subscriptions (with guest checkout enabled, PayPal Credit disabled) -->
<script
  src="https://www.paypal.com/sdk/js?client-id=ARmFJUNL-2grFv62pdVgTgbaulkPP-lj2_3yEpzjdtz6RWt-h7ISTHqKTolA715eeR-74mIyu-MNE6Mp&vault=true&intent=subscription&disable-funding=credit"
  data-namespace="paypalSub"
></script>
</head>
<body>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script>
    // TODO: Replace these with your Firebase project configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAL6r2dwjqRF2Mv01B3GHfZSxNBrq7yWGU",
      authDomain: "cardlocker-bd09a.firebaseapp.com",
      projectId: "cardlocker-bd09a",
      storageBucket: "cardlocker-bd09a.firebasestorage.app",
      messagingSenderId: "729816549959",
      appId: "1:729816549959:web:4e34482d004dcf3a6cff62"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Generate a simple random license key
    function generateLicenseKey() {
      // Example: return a random 16-character hexadecimal string
      return 'xxxx-xxxx-xxxx-xxxx'.replace(/x/g, () =>
        Math.floor(Math.random() * 16).toString(16)
      ).toUpperCase();
    }
  </script>
  <div class="container">
    <!-- ===== Navbar ===== -->
    <nav class="navbar">
      <div class="nav-brand">CardLocker</div>
      <ul class="nav-links">
        <li><a href="#features">Features</a></li>
        <li><a href="#how-it-works">How It Works</a></li>
        <li><a href="#pricing">Pricing</a></li>
        <li><a href="#purchase">Purchase</a></li>
        <li><a href="#resend">Resend Code</a></li>
      </ul>
    </nav>

    <!-- ===== Hero Section ===== -->
    <header id="featured" class="hero">
      <h1 class="title-with-icon">
        <img src="cardmock2.png" alt="CardLocker Icon" class="app-icon-inline" />
        CardLocker for macOS
      </h1>
      <p class="intro">
        CardLocker is the card manager you've always wished Apple would build. 
        No more hunting through Safari's Autofill or digging out your physical wallet. 
        Inspired by the clean design and functionality of Apple's Passwords app, CardLocker 
        brings that same polished, native feel to your credit and debit cards.
      </p>
    </header>

    <!-- ===== Main Content ===== -->
    <main>
      <div class="card-container">
        <div class="card" id="pricing">
          <h2>Pricing</h2>
          <p>Choose the plan that suits you. A lifetime license is truly a lifetime license –– you will receive all future updates at no additional cost.</p>
          <div class="plan-options">
            <div class="plan">
              <h3>Subscription</h3>
              <p><strong>$0.99/month</strong> – Cancel anytime</p>
              <button class="plan-select" data-plan="subscribe">Select</button>
              <div class="email-field" style="display: none;">
                <div style="display: flex; align-items: center; gap: 6px;">
                  <input type="email" id="sub-email" placeholder="Enter your email" required>
                  <button id="confirm-sub-email" class="confirm-btn">Confirm</button>
                  <span id="check-sub-email" class="checkmark" style="display: none;">✔️</span>
                </div>
                <div id="paypal-sub-buttons" style="display: none;">
                  <div id="paypal-button-container-subscribe"></div>
                </div>
              </div>
            </div>
            <div class="plan">
              <div class="badge">Best Value</div>
              <h3>Lifetime License</h3>
              <p><strong>$14.99</strong> – One-time payment</p>
              <button class="plan-select" data-plan="lifetime">Select</button>
              <div class="email-field" style="display: none;">
                <div style="display: flex; align-items: center; gap: 6px;">
                  <input type="email" id="one-email" placeholder="Enter your email" required>
                  <button id="confirm-one-email" class="confirm-btn">Confirm</button>
                  <span id="check-one-email" class="checkmark" style="display: none;">✔️</span>
                </div>
                <div id="paypal-one-buttons" style="display: none;">
                  <div id="paypal-container-8D52BLYAL3DF2"></div>
                </div>
              </div>
            </div>
          </div>
        </div>


        <!-- Key Features -->
        <div class="card" id="features">
          <h2>Key Features</h2>
          <ul>
            <li><strong>Native macOS Experience:</strong> Tucked in your menu bar or standalone window—with familiar controls and smooth animations.</li>
            <li><strong>Simple Card Entry:</strong> Tap "+" to enter nickname, number, expiry, CVV—then save in a native-style form.</li>
            <li><strong>Secure Storage:</strong> Card numbers stay locked in your Keychain; only non-sensitive metadata travels over iCloud.</li>
            <li><strong>Quick Access:</strong> Click to edit inline or enter Edit mode for bulk delete/recovery.</li>
            <li><strong>Recovery Options:</strong> Deleted cards live in "Recently Deleted" for 30 days.</li>
            <li><strong>Efficient Search and Organization:</strong> Lightning-fast search, filters (Credit, Debit, Rewards, Business, Deleted), and smart sorting.</li>
            <li><strong>Customization:</strong> Dark Mode support and customizable category labels to fit right into macOS.</li>
          </ul>
        </div>

        <div class="card" id="how-it-works">
          <h2>How It Works</h2>
          <p>CardLocker never transmits your raw card data anywhere. Here's how it keeps your information secure:</p>
          <ul>
            <li><strong>Local Encryption:</strong> All card numbers are encrypted and stored in your macOS Keychain. Only your device's secure enclave can decrypt the data.</li>
            <li><strong>No Server Storage:</strong> We never upload your sensitive card details to any server. Only non-sensitive metadata (like nicknames and categories) can be optionally synced via iCloud.</li>
            <li><strong>Open Source Transparency:</strong> The full source code is available on GitHub so you can audit every line: 
              <a href="https://github.com/zeroxjf/CardLocker" target="_blank" rel="noopener">github.com/zeroxjf/CardLocker</a>.
            </li>
            <li><strong>Secure Key Generation:</strong> License keys are generated client-side and stored in Firestore associated only with your email; CardLocker never holds your payment credentials.</li>
          </ul>
        </div>
      </div>

      <div class="side-panel">
        <img src="display1.png" alt="CardLocker Screenshot 1" class="screenshot" />
        <img src="display2.png" alt="CardLocker Screenshot 2" class="screenshot" />


        <div class="card license-section" id="resend">
          <h2>Resend License Code</h2>
          <p>Enter your email to receive your license code.</p>
          <div style="display: flex; align-items: center; gap: 8px; margin-top: 12px;">
            <input id="emailInput" type="email" placeholder="Enter your email" required style="flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" />
            <button id="confirmEmailBtn" style="padding: 8px 12px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
              Confirm
            </button>
          </div>
          <div id="resend-result"></div>
        </div>
      </div>
    </main>


    <p class="privacy-disclaimer">
      CardLocker is designed with your privacy in mind. The developer does not collect any data from this app. All sensitive information is securely stored in your device's Keychain.
    </p>

    <!-- ===== Footer ===== -->
    <footer class="site-footer">
      <div class="footer-container">
        <div>&copy; 2025 CardLocker. All rights reserved.</div>
        <div class="footer-links">
          <a href="#features">Features</a> |
          <a href="#purchase">Purchase</a> |
          <a href="#resend">Resend Code</a>
        </div>
      </div>
    </footer>
</div>
  <div class="modal-backdrop" id="thankyou-modal">
    <div class="modal">
      <h3>Thank You for Your Purchase!</h3>
      <p id="modal-message">
        A license key has been emailed to you at <span id="customer-email"></span>. Your key is:
      </p>
      <p><strong id="customer-license"></strong></p>
      <p>You can download CardLocker for macOS here:</p>
      <p>
        <a id="download-link" href="https://github.com/johnnycardlocker/CardLocker/releases/latest/download/CardLocker.dmg" target="_blank" rel="noopener">
          Download CardLocker
        </a>
      </p>
      <button class="close-btn" id="close-modal">Close</button>
    </div>
  </div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Function to display the thank you modal
    function showThankYouModal(email, licenseKey) {
      document.getElementById('customer-email').textContent = email;
      document.getElementById('customer-license').textContent = licenseKey;
      const backdrop = document.getElementById('thankyou-modal');
      backdrop.classList.add('show');
      // Close button handler
      document.getElementById('close-modal').addEventListener('click', () => {
        backdrop.classList.remove('show');
      });
    }
    // Helper to validate email format
    function isValidEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    // Find all plan-select buttons
    const planButtons = document.querySelectorAll('.plan-select');

    planButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        // Hide all other email fields first
        document.querySelectorAll('.email-field').forEach(field => {
          field.style.display = 'none';
        });
        // Show the email field next to this button
        const planDiv = btn.closest('.plan');
        const emailField = planDiv.querySelector('.email-field');
        emailField.style.display = 'flex';
        // Focus the email input
        const input = planDiv.dataset.plan === 'subscribe'
          ? emailField.querySelector('#sub-email')
          : emailField.querySelector('#one-email');
        input.focus();
      });
    });

    // Subscription Confirm button logic
    document.getElementById("confirm-sub-email").onclick = function () {
      const email = document.getElementById("sub-email").value;
      if (!email || !email.includes("@")) {
        alert("Please enter a valid email.");
        return;
      }
      document.getElementById("confirm-sub-email").classList.add("confirmed");
      document.getElementById("check-sub-email").style.display = "inline";
      document.getElementById("paypal-sub-buttons").style.display = "block";
      // Render PayPal button if not already rendered
      const subContainer = document.getElementById('paypal-button-container-subscribe');
      if (!subContainer.hasChildNodes()) {
        paypalSub.Buttons({
          style: {
            shape: 'rect',
            color: 'blue',
            layout: 'vertical',
            label: 'subscribe'
          },
          createSubscription(data, actions) {
            return actions.subscription.create({
              plan_id: 'P-0UR33161F2240691LNA7RJ4A',
              subscriber: {
                email_address: email
              },
              application_context: {
                brand_name: 'CardLocker',
                landing_page: 'BILLING',
                user_action: 'SUBSCRIBE_NOW',
                payment_method: {
                  payee_preferred: 'UNRESTRICTED'
                },
                shipping_preference: 'NO_SHIPPING'
              }
            });
          },
          onApprove: async function (data) {
            // Always retrieve the email from the input field
            const subEmail = document.getElementById('sub-email')?.value || '';
            // Send email to backend in JSON body for subscription
            fetch('/api/paypal-webhook', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                subscriptionId: data.subscriptionID,
                email: subEmail
              })
            });
            // Show "Thank You" modal with placeholder
            showThankYouModal(subEmail, 'Generating license…');
            let attempts = 0;
            const maxAttempts = 15;
            const interval = setInterval(async () => {
              attempts++;
              try {
                const resp = await fetch(`/api/check-license?paypalId=${encodeURIComponent(data.subscriptionID)}`);
                const { found, licenseKey } = await resp.json();
                if (found) {
                  clearInterval(interval);
                  document.getElementById('customer-license').textContent = licenseKey;
                } else if (attempts >= maxAttempts) {
                  clearInterval(interval);
                  alert('License generation taking longer than expected. Please contact support.');
                }
              } catch (err) {
                clearInterval(interval);
                console.error('License polling error:', err);
                alert('Error checking license status. Please contact support.');
              }
            }, 2000);
          },
          onError(err) {
            console.error('PayPal subscription error:', err);
            alert('Subscription failed. Please try again.');
          }
        }).render('#paypal-button-container-subscribe');
      }
    };

    // Lifetime Confirm button logic
    document.getElementById("confirm-one-email").onclick = function () {
      const email = document.getElementById("one-email").value;
      if (!email || !email.includes("@")) {
        alert("Please enter a valid email.");
        return;
      }
      document.getElementById("confirm-one-email").classList.add("confirmed");
      document.getElementById("check-one-email").style.display = "inline";
      document.getElementById("paypal-one-buttons").style.display = "block";
      // Render PayPal button if not already rendered
      const lifeContainer = document.getElementById('paypal-container-8D52BLYAL3DF2');
      if (!lifeContainer.hasChildNodes()) {
        paypalBuy.Buttons({
          style: {
            shape: 'rect',
            color: 'gold',
            layout: 'vertical',
            label: 'buynow'
          },
          createOrder(data, actions) {
            return actions.order.create({
              purchase_units: [{
                description: 'CardLocker Lifetime License',
                amount: {
                  currency_code: 'USD',
                  value: '20.00'
                }
              }],
              application_context: {
                brand_name: 'CardLocker',
                landing_page: 'BILLING',
                user_action: 'PAY_NOW',
                payment_method: {
                  payee_preferred: 'UNRESTRICTED'
                },
                shipping_preference: 'NO_SHIPPING'
              }
            });
          },
          onApprove(data, actions) {
            // Always retrieve the email from the input field
            const emailInput = document.getElementById('one-email');
            const userEmail = emailInput ? emailInput.value.trim() : email;
            const paypalId = data.subscriptionID || data.orderID;
            if (userEmail && paypalId) {
              // Send email to backend in JSON body for one-time
              fetch('/api/create-license', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  paypalId: paypalId,
                  email: userEmail,
                  purchaseType: 'one-time'
                })
              }).catch(() => {});
            }
            // Always send email to /api/paypal-webhook for manual trigger
            if (userEmail && paypalId) {
              fetch('/api/paypal-webhook', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  email: userEmail,
                  paypalId: paypalId,
                  eventType: 'manual_trigger'
                })
              }).catch(() => {});
            }
            // Show "Thank You" modal with placeholder
            showThankYouModal(userEmail, 'Generating license…');
            let attempts = 0;
            const maxAttempts = 15;
            const interval = setInterval(async () => {
              attempts++;
              try {
                const resp = await fetch(`/api/check-license?paypalId=${encodeURIComponent(paypalId)}`);
                const { found, licenseKey } = await resp.json();
                if (found) {
                  clearInterval(interval);
                  document.getElementById('customer-license').textContent = licenseKey;
                } else if (attempts >= maxAttempts) {
                  clearInterval(interval);
                  alert('License generation taking longer than expected. Please contact support.');
                }
              } catch (err) {
                clearInterval(interval);
                console.error('License polling error:', err);
                alert('Error checking license status. Please contact support.');
              }
            }, 2000);
          },
          onError(err) {
            console.error('PayPal one-time purchase error:', err);
            alert('Purchase failed. Please try again.');
          }
        }).render('#paypal-container-8D52BLYAL3DF2');
      }
    };
  });
</script>
<script>
  // Confirm email and visually confirm the email with alert
  document.getElementById('confirmEmailBtn').addEventListener('click', async () => {
    const email = document.getElementById('emailInput').value.trim();
    if (email) {
      alert(`You entered: ${email}\nPlease double-check it before submitting.`);
      // Optionally, you can send the email to your backend to retrieve license here
      // Example: fetch license by email (adapt endpoint as needed)
      try {
        const resp = await fetch('https://www.cardlocker.net/api/check-license?paypalId=' + encodeURIComponent(email));
        const clone = resp.clone();
        let data;
        try {
          data = await resp.json();
        } catch (jsonErr) {
          const rawText = await clone.text();
          console.error('❌ Failed to parse JSON. Raw response:', rawText);
          alert('Server error — could not retrieve license. Check console for details.');
          return;
        }
        if (data && data.found && data.licenseKey) {
          // Show modal with the license key
          document.getElementById('customer-license').textContent = data.licenseKey;
          document.getElementById('customer-email').textContent = '';
          document.getElementById('modal-message').textContent = 'The license key associated with this email is:';
          const modal = document.getElementById('thankyou-modal');
          modal.classList.add('show');
          document.getElementById('close-modal').addEventListener('click', () => {
            modal.classList.remove('show');
          });
        } else {
          alert('Could not find a license for that email. Please check your info or contact support.');
        }
      } catch (err) {
        console.error('Error retrieving license:', err);
        alert('Error processing request. Please try again later.');
      }
    }
  });
</script>
<script>
  document.getElementById('confirm-subscribe')?.addEventListener('click', () => {
    const email = document.getElementById('email-subscribe').value.trim();
    if (email) alert(`You entered: ${email}\nPlease confirm it's correct.`);
  });

  document.getElementById('confirm-lifetime')?.addEventListener('click', () => {
    const email = document.getElementById('email-lifetime').value.trim();
    if (email) alert(`You entered: ${email}\nPlease confirm it's correct.`);
  });
</script>
</body>
</html>